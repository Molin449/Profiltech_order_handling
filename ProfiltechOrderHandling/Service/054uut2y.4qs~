using Newtonsoft.Json;
using ProfiltechOrderHandling.Model;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text;
using System.Threading.Tasks;

namespace ProfiltechOrderHandling.Service {
    class OrdersService {

        public Order GetOrder() {
            HttpClient client = new HttpClient();
            string secretKey = "consumer_secret=cs_e8a2af9cd6ba82b2facf921607efbc6792ecd989";
            string consumerKey = "consumer_key=ck_73c957bfdcd6f0f60e8922f971807f7c4d24aa4e";

            client.BaseAddress = new Uri("https://profiltech.dk/");
            // Add an Accept header for JSON format.
            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));


            // List all Names.
            HttpResponseMessage response = client.GetAsync($"wp-json/wc/v3/orders/?{secretKey}&{consumerKey}").Result;  // Blocking call!

            string orderJson = "{\"id\":40607,\"parent_id\":0,\"status\":\"new-order\",\"currency\":\"DKK\",\"version\":\"5.7.1\",\"prices_include_tax\":true,\"date_created\":\"2021-10-01T22:51:44\",\"date_modified\":\"2021-10-01T22:54:50\",\"discount_total\":\"0.00\",\"discount_tax\":\"0.00\",\"shipping_total\":\"0.00\",\"shipping_tax\":\"0.00\",\"cart_tax\":\"1398.39\",\"total\":\"6991.95\",\"total_tax\":\"1398.39\",\"customer_id\":0,\"order_key\":\"wc_order_aEdUO34TxNhvB\",\"billing\":{\"first_name\":\"Emil Back\",\"last_name\":\"S\u00f8rensen\",\"company\":\"\",\"address_1\":\"M\u00f8lleskovvej 128\",\"address_2\":\"\",\"city\":\"Store Merl\u00f8se\",\"state\":\"\",\"postcode\":\"4370\",\"country\":\"DK\",\"email\":\"back.bach@mail.tele.dk\",\"phone\":\"21830211\"},\"shipping\":{\"first_name\":\"Emil Back\",\"last_name\":\"S\u00f8rensen\",\"company\":\"\",\"address_1\":\"M\u00f8lleskovvej 128\",\"address_2\":\"\",\"city\":\"Store Merl\u00f8se\",\"state\":\"\",\"postcode\":\"4370\",\"country\":\"DK\",\"phone\":\"\"},\"payment_method\":\"bambora\",\"payment_method_title\":\"Bambora Online Checkout\",\"transaction_id\":\"242788120298297344\",\"customer_ip_address\":\"5.186.121.60\",\"customer_user_agent\":\"Mozilla\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/93.0.4577.63 Safari\/537.36 Edg\/93.0.961.47\",\"created_via\":\"checkout\",\"customer_note\":\"Palle stilles p\u00e5 grusvej, ved gul lade.\",\"date_completed\":null,\"date_paid\":\"2021-10-01T22:54:48\",\"cart_hash\":\"1188e03247457df9ba6b8b38089705f4\",\"number\":\"40607\",\"meta_data\":[{\"id\":1787220,\"key\":\"_billing_kundetype\",\"value\":\"privat\"},{\"id\":1787221,\"key\":\"_billing_momsnummer\",\"value\":\"\"},{\"id\":1787222,\"key\":\"_shipping_kundetype\",\"value\":\"privat\"},{\"id\":1787223,\"key\":\"_shipping_momsnummer\",\"value\":\"\"},{\"id\":1787224,\"key\":\"is_vat_exempt\",\"value\":\"no\"},{\"id\":1787225,\"key\":\"billing_kundetype\",\"value\":\"privat\"},{\"id\":1787233,\"key\":\"_new_order_email_sent\",\"value\":\"true\"},{\"id\":1787235,\"key\":\"_pys_purchase_event_fired\",\"value\":\"1\"},{\"id\":1787236,\"key\":\"_ga_tracked\",\"value\":\"1\"}],\"line_items\":[{\"id\":41905,\"name\":\"TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm)\",\"product_id\":940,\"variation_id\":944,\"quantity\":8,\"tax_class\":\"\",\"subtotal\":\"1642.56\",\"subtotal_tax\":\"410.64\",\"total\":\"1642.56\",\"total_tax\":\"410.64\",\"taxes\":[{\"id\":1,\"total\":\"410.64\",\"subtotal\":\"410.64\"}],\"meta_data\":[{\"id\":401186,\"key\":\"_wdp_initial_item_subtotal\",\"value\":\"1642.56\",\"display_key\":\"_wdp_initial_item_subtotal\",\"display_value\":\"1642.56\"},{\"id\":401187,\"key\":\"_wdp_initial_item_subtotal_tax\",\"value\":\"410.64\",\"display_key\":\"_wdp_initial_item_subtotal_tax\",\"display_value\":\"410.64\"},{\"id\":401188,\"key\":\"laengde\",\"value\":\"3,0 meter\",\"display_key\":\"L\u00e6ngde\",\"display_value\":\"3,0 meter\"},{\"id\":401189,\"key\":\"dripstop-dug-kun-paa-farven-sort\",\"value\":\"Nej tak\",\"display_key\":\"Dripstop dug (Kun p\u00e5 farven sort)\",\"display_value\":\"Nej tak\"},{\"id\":401190,\"key\":\"pa_vaelg-farve\",\"value\":\"svensk-rod-ral-3013\",\"display_key\":\"farve\",\"display_value\":\"Svensk r\u00f8d RAL: 3013\"},{\"id\":401191,\"key\":\"_ni_cost_goods\",\"value\":\"127.63\",\"display_key\":\"_ni_cost_goods\",\"display_value\":\"127.63\"},{\"id\":401272,\"key\":\"_WCPA_order_meta_data\",\"value\":\"\",\"display_key\":\"_WCPA_order_meta_data\",\"display_value\":\"\"}],\"sku\":\"110800549\",\"price\":205.31999999999999317878973670303821563720703125,\"parent_name\":\"TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm)\"},{\"id\":41906,\"name\":\"TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm)\",\"product_id\":940,\"variation_id\":39428,\"quantity\":5,\"tax_class\":\"\",\"subtotal\":\"1197.72\",\"subtotal_tax\":\"299.43\",\"total\":\"1197.72\",\"total_tax\":\"299.43\",\"taxes\":[{\"id\":1,\"total\":\"299.43\",\"subtotal\":\"299.43\"}],\"meta_data\":[{\"id\":401201,\"key\":\"_wdp_initial_item_subtotal\",\"value\":\"1197.72\",\"display_key\":\"_wdp_initial_item_subtotal\",\"display_value\":\"1197.72\"},{\"id\":401202,\"key\":\"_wdp_initial_item_subtotal_tax\",\"value\":\"299.43\",\"display_key\":\"_wdp_initial_item_subtotal_tax\",\"display_value\":\"299.43\"},{\"id\":401203,\"key\":\"laengde\",\"value\":\"3,5 meter\",\"display_key\":\"L\u00e6ngde\",\"display_value\":\"3,5 meter\"},{\"id\":401204,\"key\":\"dripstop-dug-kun-paa-farven-sort\",\"value\":\"Nej tak\",\"display_key\":\"Dripstop dug (Kun p\u00e5 farven sort)\",\"display_value\":\"Nej tak\"},{\"id\":401205,\"key\":\"pa_vaelg-farve\",\"value\":\"svensk-rod-ral-3013\",\"display_key\":\"farve\",\"display_value\":\"Svensk r\u00f8d RAL: 3013\"},{\"id\":401206,\"key\":\"_ni_cost_goods\",\"value\":\"149.28\",\"display_key\":\"_ni_cost_goods\",\"display_value\":\"149.28\"},{\"id\":401273,\"key\":\"_WCPA_order_meta_data\",\"value\":\"\",\"display_key\":\"_WCPA_order_meta_data\",\"display_value\":\"\"}],\"sku\":\"11080036\",\"price\":239.544000000000011141310096718370914459228515625,\"parent_name\":\"TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm)\"},{\"id\":41907,\"name\":\"TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm)\",\"product_id\":940,\"variation_id\":942,\"quantity\":10,\"tax_class\":\"\",\"subtotal\":\"1711.04\",\"subtotal_tax\":\"427.76\",\"total\":\"1711.04\",\"total_tax\":\"427.76\",\"taxes\":[{\"id\":1,\"total\":\"427.76\",\"subtotal\":\"427.76\"}],\"meta_data\":[{\"id\":401216,\"key\":\"_wdp_initial_item_subtotal\",\"value\":\"1711.04\",\"display_key\":\"_wdp_initial_item_subtotal\",\"display_value\":\"1711.04\"},{\"id\":401217,\"key\":\"_wdp_initial_item_subtotal_tax\",\"value\":\"427.76\",\"display_key\":\"_wdp_initial_item_subtotal_tax\",\"display_value\":\"427.76\"},{\"id\":401218,\"key\":\"laengde\",\"value\":\"2,5 meter\",\"display_key\":\"L\u00e6ngde\",\"display_value\":\"2,5 meter\"},{\"id\":401219,\"key\":\"dripstop-dug-kun-paa-farven-sort\",\"value\":\"Nej tak\",\"display_key\":\"Dripstop dug (Kun p\u00e5 farven sort)\",\"display_value\":\"Nej tak\"},{\"id\":401220,\"key\":\"pa_vaelg-farve\",\"value\":\"svensk-rod-ral-3013\",\"display_key\":\"farve\",\"display_value\":\"Svensk r\u00f8d RAL: 3013\"},{\"id\":401221,\"key\":\"_ni_cost_goods\",\"value\":\"106.63\",\"display_key\":\"_ni_cost_goods\",\"display_value\":\"106.63\"},{\"id\":401274,\"key\":\"_WCPA_order_meta_data\",\"value\":\"\",\"display_key\":\"_WCPA_order_meta_data\",\"display_value\":\"\"}],\"sku\":\"110800548\",\"price\":171.10399999999998499333742074668407440185546875,\"parent_name\":\"TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm)\"},{\"id\":41908,\"name\":\"TP 18 Skum-t\u00e6tnings klodser lille top\",\"product_id\":448,\"variation_id\":0,\"quantity\":38,\"tax_class\":\"\",\"subtotal\":\"741.76\",\"subtotal_tax\":\"185.44\",\"total\":\"741.76\",\"total_tax\":\"185.44\",\"taxes\":[{\"id\":1,\"total\":\"185.44\",\"subtotal\":\"185.44\"}],\"meta_data\":[{\"id\":401231,\"key\":\"_wdp_initial_item_subtotal\",\"value\":\"741.76\",\"display_key\":\"_wdp_initial_item_subtotal\",\"display_value\":\"741.76\"},{\"id\":401232,\"key\":\"_wdp_initial_item_subtotal_tax\",\"value\":\"185.44\",\"display_key\":\"_wdp_initial_item_subtotal_tax\",\"display_value\":\"185.44\"},{\"id\":401233,\"key\":\"_ni_cost_goods\",\"value\":\"2.05\",\"display_key\":\"_ni_cost_goods\",\"display_value\":\"2.05\"},{\"id\":401275,\"key\":\"_WCPA_order_meta_data\",\"value\":\"\",\"display_key\":\"_WCPA_order_meta_data\",\"display_value\":\"\"}],\"sku\":\"11010003\",\"price\":19.519999999999999573674358543939888477325439453125,\"parent_name\":null},{\"id\":41909,\"name\":\"Farmer skrue til overlap og indd\u00e6kninger 23 mm\",\"product_id\":405,\"variation_id\":2113,\"quantity\":1,\"tax_class\":\"\",\"subtotal\":\"100.16\",\"subtotal_tax\":\"25.04\",\"total\":\"100.16\",\"total_tax\":\"25.04\",\"taxes\":[{\"id\":1,\"total\":\"25.04\",\"subtotal\":\"25.04\"}],\"meta_data\":[{\"id\":401243,\"key\":\"_wdp_initial_item_subtotal\",\"value\":\"100.16\",\"display_key\":\"_wdp_initial_item_subtotal\",\"display_value\":\"100.16\"},{\"id\":401244,\"key\":\"_wdp_initial_item_subtotal_tax\",\"value\":\"25.04\",\"display_key\":\"_wdp_initial_item_subtotal_tax\",\"display_value\":\"25.04\"},{\"id\":401245,\"key\":\"pa_vaelg-farve\",\"value\":\"svensk-rod-ral-3013\",\"display_key\":\"farve\",\"display_value\":\"Svensk r\u00f8d RAL: 3013\"},{\"id\":401246,\"key\":\"_ni_cost_goods\",\"value\":\"21.18\",\"display_key\":\"_ni_cost_goods\",\"display_value\":\"21.18\"},{\"id\":401276,\"key\":\"_WCPA_order_meta_data\",\"value\":\"\",\"display_key\":\"_WCPA_order_meta_data\",\"display_value\":\"\"}],\"sku\":\"11070002\",\"price\":100.159999999999996589394868351519107818603515625,\"parent_name\":\"Farmer skrue til overlap og indd\u00e6kninger 23 mm\"},{\"id\":41910,\"name\":\"Farmer tag & facade monterings skrue 35 mm\",\"product_id\":398,\"variation_id\":2116,\"quantity\":2,\"tax_class\":\"\",\"subtotal\":\"200.32\",\"subtotal_tax\":\"50.08\",\"total\":\"200.32\",\"total_tax\":\"50.08\",\"taxes\":[{\"id\":1,\"total\":\"50.08\",\"subtotal\":\"50.08\"}],\"meta_data\":[{\"id\":401256,\"key\":\"_wdp_initial_item_subtotal\",\"value\":\"200.32\",\"display_key\":\"_wdp_initial_item_subtotal\",\"display_value\":\"200.32\"},{\"id\":401257,\"key\":\"_wdp_initial_item_subtotal_tax\",\"value\":\"50.08\",\"display_key\":\"_wdp_initial_item_subtotal_tax\",\"display_value\":\"50.08\"},{\"id\":401258,\"key\":\"pa_vaelg-farve\",\"value\":\"svensk-rod-ral-3013\",\"display_key\":\"farve\",\"display_value\":\"Svensk r\u00f8d RAL: 3013\"},{\"id\":401259,\"key\":\"_ni_cost_goods\",\"value\":\"21.18\",\"display_key\":\"_ni_cost_goods\",\"display_value\":\"21.18\"},{\"id\":401277,\"key\":\"_WCPA_order_meta_data\",\"value\":\"\",\"display_key\":\"_WCPA_order_meta_data\",\"display_value\":\"\"}],\"sku\":\"11070004\",\"price\":100.159999999999996589394868351519107818603515625,\"parent_name\":\"Farmer tag & facade monterings skrue 35 mm\"}],\"tax_lines\":[{\"id\":41912,\"rate_code\":\"DK-STANDART MOMS-1\",\"rate_id\":1,\"label\":\"Standart moms\",\"compound\":true,\"tax_total\":\"1398.39\",\"shipping_tax_total\":\"0.00\",\"rate_percent\":25,\"meta_data\":[]}],\"shipping_lines\":[{\"id\":41911,\"method_title\":\"Fri levering\",\"method_id\":\"table_rate\",\"instance_id\":\"11\",\"total\":\"0.00\",\"total_tax\":\"0.00\",\"taxes\":[],\"meta_data\":[{\"id\":401265,\"key\":\"Varer\",\"value\":\"TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm) &times; 8, TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm) &times; 5, TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm) &times; 10, TP 18 Skum-t\u00e6tnings klodser lille top &times; 38, Farmer skrue til overlap og indd\u00e6kninger 23 mm &times; 1, Farmer tag & facade monterings skrue 35 mm &times; 2\",\"display_key\":\"Varer\",\"display_value\":\"TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm) &times; 8, TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm) &times; 5, TP18 St\u00e5ltrapezplade (d\u00e6kbredde: 1070mm) &times; 10, TP 18 Skum-t\u00e6tnings klodser lille top &times; 38, Farmer skrue til overlap og indd\u00e6kninger 23 mm &times; 1, Farmer tag &amp; facade monterings skrue 35 mm &times; 2\"}]}],\"fee_lines\":[],\"coupon_lines\":[],\"refunds\":[],\"date_created_gmt\":\"2021-10-01T20:51:44\",\"date_modified_gmt\":\"2021-10-01T20:54:50\",\"date_completed_gmt\":null,\"date_paid_gmt\":\"2021-10-01T20:54:48\",\"currency_symbol\":\"\",\"_links\":{\"self\":[{\"href\":\"https:\/\/www.profiltech.dk\/wp-json\/wc\/v3\/orders\/40607\"}],\"collection\":[{\"href\":\"https:\/\/www.profiltech.dk\/wp-json\/wc\/v3\/orders\"}]}}";

            Order order = new Order();
            if (response.IsSuccessStatusCode) {
                //string orderJson = response.Content.ReadAsStringAsync().Result;
                var orders = JsonConvert.DeserializeObject<List<Order>>(orderJson);
            }

            return order;


        }
    }
}
